# GAS デバッグガイド

「読み込み中」から変わらない問題の解決手順です。

## 🔍 問題の切り分け

### ステップ1: テストページで動作確認

まず、シンプルなテストページで基本的な接続を確認します。

1. **Code.gs** の `doGet()` 関数を一時的に以下に変更：

```javascript
function doGet() {
  getOrCreateSpreadsheetId(); // スプレッドシート初期化
  
  return HtmlService.createHtmlOutputFromFile('test')
    .setTitle('Test Page')
    .setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL);
}
```

2. **保存** → **デプロイ** → **デプロイを管理** → **編集** → **新バージョン** → **デプロイ**

3. ウェブアプリのURLを開く

4. **期待される結果**:
   - 「🔧 Family Calendar - テストページ」が表示される
   - 「サーバーに接続」ボタンをクリックすると、緑色で「✅ 成功」と表示される

### ステップ2: 結果に応じた対処

#### ✅ ケース1: テストページが表示された場合

**→ HTMLの読み込みは正常です。**

次に、`index_GAS.html` の問題を確認します：

**よくある問題:**

1. **ファイル名が間違っている**
   - GASエディタで、HTMLファイルの名前を確認
   - `index_GAS` という名前になっているか？（拡張子なし）

2. **scriptlet構文のエラー**
   - `<?!= include('styles'); ?>` の部分が正しいか確認

**修正方法:**
- `Code.gs` の `doGet()` を以下に戻す：

```javascript
function doGet() {
  getOrCreateSpreadsheetId();
  
  return HtmlService.createTemplateFromFile('index_GAS')
    .evaluate()
    .setTitle('Family Calendar')
    .setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL);
}
```

#### ❌ ケース2: テストページも表示されない場合

**→ デプロイ設定の問題です。**

以下を確認：

1. **デプロイ設定を再確認**
   - 「デプロイ」→「デプロイを管理」
   - 「次のユーザーとして実行」→「自分」になっているか
   - 「アクセスできるユーザー」→「全員」または「Googleアカウントを持つ全員」

2. **権限の再承認**
   - GASエディタで `doGet` 関数を実行（再生ボタン）
   - 権限を求められたら、もう一度許可

3. **新しいデプロイを作成**
   - 「デプロイ」→「新しいデプロイ」
   - 新しいURLを取得してアクセス

#### ⚠️ ケース3: エラーメッセージが表示される場合

**ブラウザのコンソールを確認:**
1. ブラウザで `F12` キーを押す
2. 「Console」タブを開く
3. 赤いエラーメッセージをコピー

**よくあるエラー:**
- `google.script.run is not defined` → デプロイされていない、またはURLが間違っている
- `Permission denied` → 権限がない
- `ScriptError` → Code.gsにエラーがある

## 📋 チェックリスト

以下を順番に確認してください：

### GASエディタでの確認

- [ ] ファイルは全て作成されているか？
  - [ ] Code.gs
  - [ ] index_GAS (HTMLファイル)
  - [ ] script_GAS (HTMLファイル)
  - [ ] styles (HTMLファイル)
  - [ ] test (HTMLファイル)

- [ ] ファイル名は正確か？（拡張子なし。例: `index_GAS.html` ではなく `index_GAS`）

- [ ] Code.gsに `include` 関数があるか？

### デプロイ設定の確認

- [ ] ウェブアプリとしてデプロイされているか？
- [ ] 「種類」が「ウェブアプリ」になっているか？
- [ ] 最新バージョンがデプロイされているか？
- [ ] URLをコピーして、新しいタブで開いているか？（古いキャッシュを避けるため）

### スプレッドシートの確認

- [ ] `setupSpreadsheet` 関数を実行したか？
- [ ] 実行ログに「スプレッドシートを作成しました」と表示されたか？
- [ ] Googleドライブに「Family Calendar Data」という名前のスプレッドシートがあるか？

## 🛠️ トラブルシューティング

### 問題: 空白のページが表示される

**原因:** HTMLファイルの構文エラー、またはファイルが見つからない

**解決策:**
1. GASエディタで `index_GAS` を開く
2. 上から順に確認：
   - `<!DOCTYPE html>` で始まっているか
   - `<?!= include('styles'); ?>` が `<style>` タグの中にあるか
   - 閉じタグ `</html>` まであるか

### 問題: 「読み込み中...」のまま止まる

**原因:** JavaScriptのエラー、またはサーバー接続の問題

**解決策:**
1. ブラウザの開発者ツールを開く（F12）
2. Consoleタブでエラーを確認
3. Networkタブで通信を確認

**よくある原因:**
- `getAllEvents()` の初回呼び出しが失敗している
- スプレッドシートが初期化されていない → `setupSpreadsheet` を実行

### 問題: 「このアプリは確認されていません」と表示される

**原因:** 自分で作成したアプリなので、Googleの確認プロセスを経ていない

**解決策:**
1. 「詳細」をクリック
2. 「（アプリ名）に移動（安全ではないページ）」をクリック
3. これは正常な動作です（自分のアプリなので信頼できます）

## ✅ 成功の確認

テストページで「✅ 成功」が表示されたら、`Code.gs` の `doGet()` を元に戻して、本番のカレンダーをデプロイしてください。

## 💬 それでも解決しない場合

以下の情報を教えてください：

1. どのステップまで進められたか
2. ブラウザのコンソールに表示されているエラーメッセージ（あれば）
3. GASエディタの実行ログ（「表示」→「ログ」）
4. テストページは表示されたか、されなかったか
