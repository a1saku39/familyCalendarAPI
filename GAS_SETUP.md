# Family Calendar - Google Apps Script セットアップガイド

このガイドでは、Family CalendarをGoogle Apps Script（GAS）として設定し、スマホや外出先から家族全員で共有できるようにする手順を説明します。

## 必要なファイル

以下のファイルをGASプロジェクトにアップロードします：

1. **Code.gs** - サーバーサイドのロジック
2. **index_GAS.html** → GASでは `index.html` にリネーム
3. **script_GAS.js** → GASでは `script_GAS.html` にリネーム（.htmlとして扱う）
4. **styles.css** → GASでは `styles.html` にリネーム（.htmlとして扱う）

## セットアップ手順

### ステップ 1: Google Apps Script プロジェクトを作成

1. [Google Apps Script](https://script.google.com/) にアクセス
2. 「新しいプロジェクト」をクリック
3. プロジェクト名を「Family Calendar」に変更

### ステップ 2: ファイルをアップロード

#### 2-1. Code.gs を作成
- デフォルトで作成される `Code.gs` を開く
- `Code.gs` の内容を全て削除し、ローカルの `Code.gs` の内容をコピー＆ペースト

#### 2-2. index.html を作成
- 「+」ボタン → 「HTML」をクリック
- ファイル名を `index_GAS` にする
- `index_GAS.html` の内容をコピー＆ペースト

#### 2-3. script_GAS.html を作成
- 「+」ボタン → 「HTML」をクリック
- ファイル名を `script_GAS` にする
- `script_GAS.js` の内容をコピー＆ペースト

#### 2-4. styles.html を作成
- 「+」ボタン → 「HTML」をクリック
- ファイル名を `styles` にする
- `styles.css` の内容をコピー＆ペースト

### ステップ 3: スプレッドシートを初期化

1. GASエディタで `Code.gs` を開く
2. 関数のドロップダウンから `setupSpreadsheet` を選択
3. 「実行」ボタンをクリック
4. 初回実行時、権限の許可を求められます：
   - 「権限を確認」→ 自分のGoogleアカウントを選択
   - 「詳細」→「Family Calendar（安全ではないページ）に移動」をクリック
   - 「許可」をクリック
5. 実行ログに「スプレッドシートを作成しました」と表示されます

### ステップ 4: ウェブアプリとしてデプロイ

1. 右上の「デプロイ」→「新しいデプロイ」をクリック
2. 「種類の選択」→「ウェブアプリ」を選択
3. 設定：
   - **説明**: Family Calendar（任意）
   - **次のユーザーとして実行**: 自分
   - **アクセスできるユーザー**: **全員**（家族で共有する場合）
     - または「Googleアカウントを持つ全員」を選択
4. 「デプロイ」をクリック
5. **ウェブアプリのURL**が表示されます。このURLをコピーしてください！

### ステップ 5: URLを家族と共有

1. コピーしたURLを家族にLINEやメールで送信
2. 家族がそのURLにアクセスすると、カレンダーが表示されます
3. スマホのホーム画面に追加することも可能：
   - **iPhone**: Safariで開く → 共有ボタン → 「ホーム画面に追加」
   - **Android**: Chromeで開く → メニュー → 「ホーム画面に追加」

## トラブルシューティング

### 「データベースが見つかりません」エラー
- Code.gsの `setupSpreadsheet` 関数を実行してください

### スプレッドシートのURLを確認したい
- GASエディタで以下を実行：
  ```javascript
  function test() {
    Logger.log(getSpreadsheetUrl());
  }
  ```
- 実行ログにURLが表示されます

### デプロイ後に変更を反映させたい
1. 「デプロイ」→「デプロイを管理」
2. 鉛筆アイコン（編集）をクリック
3. 「バージョン」を「新バージョン」に変更
4. 「デプロイ」をクリック

## データの管理

- すべての予定データは自動作成されたGoogleスプレッドシートに保存されます
- スプレッドシートを直接編集することも可能です
- スプレッドシートのURLは、GASのプロジェクトプロパティまたは上記の関数で確認できます

## セキュリティに関する注意

- 「アクセスできるユーザー: 全員」を選択すると、URLを知っている人は誰でもアクセスできます
- 家族のみでアクセスを制限したい場合は、以下の方法があります：
  1. 「Googleアカウントを持つ全員」を選択し、家族がGoogleアカウントでログインするようにする
  2. Code.gsにアクセス制限のロジックを追加する（メールアドレスのホワイトリストなど）

## 次のステップ

カレンダーが正常に動作していることを確認したら：
- 家族で予定を追加してみる
- カテゴリーを活用して予定を色分けする
- スマホのホーム画面に追加して、いつでもアクセスできるようにする

楽しい家族カレンダーライフを！
